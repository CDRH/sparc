<!DOCTYPE html>
<html>
<head>
  <title>Sparc</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>

<script>
  var edit_html_location = null;
  var selected_id = null;
  var plural_search = false;
  <% if (params[:controller] != "static") && (!params[:controller].to_s.include? 'devise') %>
    function load_internal_search(loc, column, id, label, plural) {
      edit_html_location = loc;
      selected_id = id;
      plural_search = plural;
      console.log(id);
      $.ajax({
        type: 'GET',
        url: '<%= url_for(:action => 'search_inline') if params[:controller] != 'interaction' and !params[:controller].to_s.include?('devise') %>?klass='+column+'&plural='+plural,
        success: function(data) {
          //alert(data);
          $('#myModal .modal-body').html(data);
          $('#modal-title').html(label);
          var top = window.pageYOffset || document.documentElement.scrollTop;
          $('#myModal').modal('show');
         // Get the document offset :
        }
      })
      return false;
    }
  <% end %>

  $(function() {
    $('#myModal .modal-footer button').on('click', function (e) {
        var $target = $(e.target); // Clicked button element
          console.log($target[0].textContent); // Logged if the clicked button actually closed the modal
      if($target[0].textContent == 'OK') {
        $('#myModal input:checked').each(function(k,v) {
          if(!plural_search) {
            $('#'+edit_html_location).html('<input type="hidden" name="'+selected_id+'" value="'+$(v).val()+'">'+$(v)[0].nextSibling.data);
          } else {
            $('#'+edit_html_location).append('<input type="checkbox" checked class="related-checkbox" name="'+selected_id+'" value="'+$(v).val()+'">'+$(v)[0].nextSibling.data+'<br>');
          }
          console.log($(v)[0].nextSibling.data);
        })
      }
    });
  });
</script>

<body>
  <nav role="navigation" class="navbar navbar-default">
    <div class="navbar-header">
      <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <!-- <a href="/interaction" class="navbar-brand">Chaco</a> -->
      <%#= link_to('Chaco', {controller: 'interaction', action: 'index'}, class: "navbar-brand")%>
    </div>
    <!-- Collection of nav links and other content for toggling -->
    <div id="navbarCollapse" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><%= link_to "Home", home_path %></li>
        <li class="dropdown">
          <a class="dropdown-toggle" id="drop4" role="button" data-toggle="dropdown" href="#">Contents <b class="caret"></b></a>
          <ul id="menu1" class="dropdown-menu" role="menu" aria-labelledby="drop4">
            <li><%= link_to('Units', admin_units_path)%></li>
            <li><%= link_to('Strata', admin_strata_path)%></li>
            <li><%= link_to('Features', admin_features_path)%></li>
            <%# begin alphabetical %>
            <li><%= link_to('Bone Inventories', admin_bone_inventories_path)%></li>
            <li><%= link_to('Bone Tools', admin_bone_tools_path)%></li>
            <li><%= link_to('Ceramic Inventories', admin_ceramic_inventories_path)%></li>
            <li><%= link_to('Eggshells', admin_eggshells_path)%></li>
            <li><%= link_to('Lithic Inventories', admin_lithic_inventories_path)%></li>
            <li><%= link_to('Images', admin_images_path)%></li>
            <li><%= link_to('Ornaments', admin_ornaments_path)%></li>
            <li><%= link_to('Perishables', admin_perishables_path)%></li>
            <li><%= link_to('Select Artifacts', admin_select_artifacts_path)%></li>
            <li><%= link_to('Soils', admin_soils_path)%></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <% if user_signed_in? %>
          <li>
            <%= link_to('Logout', destroy_user_session_path, :method=>'delete') %>
          </li>
        <% else %>
          <li><%= link_to('Login', new_user_session_path) %></li>
        <% end %>
      </ul>
    </div>
  </nav>

  <%= render 'layouts/messages' %>
    <%= yield %>
    <div id="myModal"  class="modal fade" role="dialog">
       <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title" id="modal-title">Modal Header</h4>
          </div>
          <div class="modal-body" id="modal-body">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default ok-button" data-dismiss="modal">OK</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</body>

</html>
