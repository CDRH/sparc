<h1>Search All Units</h1>

<%= form_tag search_path, :method => "get",
  id: "unit-search-form", role: "form" do %>
  <%= hidden_field_tag "sort", params["sort"] %>

  <div class="row">
    <!-- location -->
    <div class="col-md-3">
      <div class="form-group">
        <%= label_tag "unit_no", "Unit Number" %>
        <%= text_field_tag "unit_no", params["unit_no"], placeholder: "BW", class: "form-control" %>
      </div>
      <%= render :partial => "dropdown",
        :locals => { :column => "excavation_status", :classname => ExcavationStatus, :alt_label => nil } %>
    </div>

    <!-- description -->
    <div class="col-md-3">
      <%= render :partial => "dropdown",
        :locals => { :column => "intact_roof", :classname => IntactRoof, :alt_label => nil } %>
      <%= render :partial => "dropdown",
        :locals => { :column => "irregular_shape", :classname => IrregularShape, :alt_label => nil } %>
    </div>

    <!-- other description -->
    <div class="col-md-3">
      <%= render :partial => "dropdown",
        :locals => { :column => "story", :classname => Story, :alt_label => "Stories" } %>
      <%= render :partial => "dropdown",
        :locals => { :column => "occupation", :classname => UnitOccupation, :alt_label => nil } %>
    </div>

    <!-- function -->
    <div class="col-md-3">
      <%= render :partial => "dropdown",
        :locals => { :column => "inferred_function", :classname => InferredFunction, :alt_label => nil } %>
      <%= render :partial => "dropdown",
        :locals => { :column => "unit_class", :classname => UnitClass, :alt_label => nil } %>
    </div>

  </div> <!-- /row -->

  <!-- COLLAPSED SEARCH OPTIONS -->
  <div class="row">
    <div class="collapse" id="collapseMore">
      <div class="well">
        <div class="row">

        <!-- location -->
          <div class="col-md-3">
            <div class="form-group">
              <%= label_tag "zone" %>
              <%= select_tag "zone", options_from_collection_for_select(
                  Zone.all, "id", "number", params["zone"]), :include_blank => true, class: "form-control" %>
            </div>
            <%= render :partial => "dropdown",
              :locals => { :column => "salmon_sector", :classname => SalmonSector, :alt_label => nil } %>
          </div>

          <!-- unit type description -->
          <div class="col-md-3">
            <% room_types = RoomType.all.map do |type| %>
              <% [ type.to_label, type.id ] %>
            <% end %>
            <div class="form-group">
              <%= label_tag "room_type" %>
              <%= select_tag("room_type", options_for_select(room_types, params["room_type"]), :include_blank => true, class: "form-control") %>
            </div>
            <%= render :partial => "dropdown",
              :locals => { :column => "type_description", :classname => TypeDescription, :alt_label => nil } %>
          </div>

          <!-- comments -->
          <div class="col-md-3">
            <div class="form-group">
              <%= label_tag "other_description", "Other Description (not much text to search?)" %>
              <%= text_field_tag "other_description", params["other_description"], placeholder: "intersticial", class: "form-control" %>
            </div>
            <div class="form-group">
              <%= label_tag "comments", "Comments" %>
              <%= text_field_tag "comments", params["comments"], placeholder: "intersticial", class: "form-control" %>
            </div>
          </div>
        </div> <!-- /row -->

    </div> <!-- /well -->
  </div>

  <div class="row">
    <a class="btn btn-info" role="button" data-toggle="collapse"
      href="#collapseMore" aria-expanded="false" aria-controls="collapseMore">
      Expand More Search Options
    </a>
    <%= link_to "Clear Search", search_path, :class => "btn btn-warning" %>
    <%= submit_tag "Search", :class => "btn btn-primary" %>
  </div> <!-- /row -->

  <p>Found <%= pluralize @result_num, "result" %></p>
  <%= will_paginate @units %>

  <% @units.each_slice(6) do |unit_set| %>
    <div class="row">
      <% unit_set.each do |unit| %>
        <div class="col-md-2">
          <h2><%= unit.unit_no %></h2>
          <ul>
            <li>Occupation: <%= unit.unit_occupation.occupation if unit.unit_occupation %>
            <li>Type: <%= unit.type_description.type_description if unit.type_description %>
            <li>Inferred Function: <%= unit.inferred_function.inferred_function if unit.inferred_function %></li>
            <!-- <li>Number of Images: <%# unit.images.size %></li> -->
          </ul>
        </div>
      <% end %>
    </div>
  <% end %>

<% end %>
