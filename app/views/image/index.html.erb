<%= stylesheet_link_tag "images", media: "all", "data-turbolinks-track" => true %>

<h1>Image Gallery</h1>

<%= form_tag gallery_path, :method => "get",
  id: "image-search-form", role: "form" do %>
  <%= hidden_field_tag "sort", params["sort"] %>
  <div class="row">

    <!-- identity -->
    <div class="col-md-3">
      <div class="form-group">
        <%= label_tag "image_no" %>
        <%= text_field_tag "image_no", params["image_no"], placeholder: "00946", class: "form-control" %>
      </div>
      <div class="form-group">
        <%= render :partial => "partials/dropdown",
          :locals => { :classname => ImageCreator, :column => "name", :label => "creator" } %>
      </div>
      <div class="form-group">
        <%= render :partial => "partials/dropdown",
          :locals => { :classname => @occupations, :column => "occupation" } %>
      </div>
    </div>

    <!-- common options -->
    <div class="col-md-3">
      <div class="form-group">
        <%= render :partial => "partials/dropdown",
          :locals => { :classname => ImageFormat, :column => "name", :label => "format" } %>
      </div>
      <div class="form-group">
        <%= render :partial => "partials/dropdown",
          :locals => { :classname => @units, :column => "unit_no", :label => "unit" } %>
      </div>
      <div class="form-group">
        <%= render :partial => "partials/dropdown",
          :locals => { :classname => @zones, :column => "number", :label => "zone" } %>
      </div>
    </div>

    <!-- qualitative -->
    <div class="col-md-3">
      <div class="form-group">
        <%= render :partial => "partials/dropdown",
          :locals => { :classname => ImageOrientation, :column => "name", :label => "orientation" } %>
      </div>
      <div class="form-group">
        <%= render :partial => "partials/dropdown",
          :locals => { :classname => ImageQuality, :column => "name", :label => "quality" } %>
      </div>
    </div>

    <!-- contents -->
    <div class="col-md-3">
      <div class="form-group">
        <%= label_tag "comments" %>
        <%= text_field_tag "comments", params["comments"], placeholder: "wall section", class: "form-control" %>
      </div>
      <div class="form-group">
        <%= render :partial => "partials/dropdown",
          :locals => { :classname => ImageSubject, :column => "subject" } %>
      </div>
    </div>
  </div> <!-- /row -->

  <div class="row">
    <div class="collapse" id="collapseMore">
      <div class="well">
        <div class="row">
          <div class="col-md-3">
            <%= render :partial => "partials/dropdown",
              :locals => { :classname => ImageBox, :column => "name", :label => "box" } %>
            </div>
          <div class="col-md-3">
            <%= render :partial => "partials/dropdown",
              :locals => { :classname => ImageHumanRemain, :column => "name", :label => "human_remain" } %>
          </div>
          <div class="col-md-3">
            <%= render :partial => "partials/dropdown",
              :locals => { :classname => ImageAssocnoeg, :column => "name", :label => "associated_negative" } %>
          </div>
        </div> <!-- /row -->
      </div> <!-- /well -->
    </div> <!-- /collapse -->
  </div> <!-- /row -->

  <div class="row">
    <button class="btn btn-info" type="button"
      data-toggle="collapse" data-target="#collapseMore"
      aria-expanded="false" aria-controls="collapseMore">
      More Query Options
    </button>
    <%= render partial: "partials/clear_search", locals: { path: gallery_path } %>
    <%= submit_tag("Search", :class => "btn btn-primary") %>
  </div>
<% end %>

<p>Found <%= pluralize(@result_num, "image") %></p>
<%= will_paginate @images %>

<% @images.each_slice(4) do |img_set| %>
  <div class="row">
    <% img_set.each do |img| %>
      <div class="col-md-3 <%= 'human_remains' if !img.displayable? %>">
        <%= link_to image_path img.image_no do %>
          <%= image_tag "field/thumb/#{img.image_no}" %>
        <% end %>
        <ul>
          <li>Units: <%= img.unit_list.join("; ") %></li>
          <li>Occupations: <%= img.occupation_list.join("; ") %></li>
          <li>Number: <%= img.image_no %></li>
          <li>Format: <%= img.format %></li>
          <li>Comments: <%= img.comments %></li>
          <li>Subjects: <%= img.subject_list.join("; ") %></li>
          <li>Human Remains: <%= img.human_remain %></li>
        </ul>
      </div>
    <% end %>
  </div>
<% end %>

<%= will_paginate @images %>

